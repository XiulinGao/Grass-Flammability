---
title: "data_explore"
author: "Xiulin Gao"
date: "11/30/2016"
output: html_document
---

load all datasets for analysis

```{r load_data include=FALSE}
source("./final_summary_dataset.R")
species <- c("Agropyron smithii", "Aristida purpurea", "Bromus inermis",
"Chasmanthium latifolium", "Elymus longifolius", "Eragrostis curvula",
"Panicum anceps", "Stipa neomexicana")
color <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", 
"#0072B2", "#D55E00", "#CC79A7")
library(pcaMethods)
```

#1a. What are the flammability axes?

 1) how flammability measurement correlated 
 
```{r pair_plot}

flam.alldata %>% filter(location == "above.sec") %>%
  subset(select = c("dur", "degsec", "peak.temp", "lossrate",
                     "max.fh")) %>%
  pairs(main="explore correlation between flammability measures 
      during flaming at >10cm section")


smog.alldata %>% filter(location == "below.sec") %>%
  subset(select = c("dur", "degsec", "peak.temp", "lossrate",
                    "max.fh")) %>%
  pairs(main="explore correlation between flammability measures
        during smoldering at <10cm section")

```
at flaming stage above 10cm plant section: duration is positively correlated with total degree of temp(>60) and peak temp. when look at the correlation between duration and biomass loss rate, i found when loss rate is fast no duration is long, however, there is long duration at slow biomass loss rate, but no general trend exists. 


at smoldering stage below 10cm plant section:

2) how many flammability axes there are

```{r flamma_pca}

flamabove.PCA <- flam.alldata %>% filter(location == "above.sec") %>%
  subset(select = c("dur", "degsec", "peak.temp", "lossrate",
                     "max.fh")) %>% pca(nPcs=5, method="ppca", center=TRUE,
                                        scale="uv")
biplot(flamabove.PCA)
summary(flamabove.PCA)
loadings(flamabove.PCA)
flam.above$PC1 <- unlist(scores(flamabove.PCA)[, 1])
flam.above$PC2 <- unlist(scores(flamabove.PCA)[, 2])

flambelow.PCA <- flam.alldata %>% filter(location == "below.sec") %>%
  subset(select = c("dur", "degsec", "peak.temp", "lossrate",
                     "max.fh")) %>% pca(nPcs=5, method="ppca", center=TRUE,
                                        scale="uv")
biplot(flambelow.PCA)
summary(flambelow.PCA)
loadings(flambelow.PCA)
flambelow.PC1 <- as.data.frame(scores(flambelow.PCA)[, 1])
flambelow.PC2 <- as.data.frame(scores(flambelow.PCA)[, 2])

smogabove.PCA <- smog.alldata %>% filter(location == "above.sec") %>%
  subset(select = c("dur", "degsec", "peak.temp", "lossrate",
                     "max.fh")) %>% pca(nPcs=5, method="ppca", center=TRUE,
                                        scale="uv")
biplot(smogabove.PCA)
summary(smogabove.PCA)
loadings(smogabove.PCA)
smogabove.PC1 <- as.data.frame(scores(smogabove.PCA)[, 1])
smogabove.PC2 <- as.data.frame(scores(smogabove.PCA)[, 2])

smogbelow.PCA <- smog.alldata %>% filter(location =="below.sec") %>%
  subset(select = c("dur", "degsec", "peak.temp", "lossrate",
                    "max.fh")) %>% pca(nPcs=5, method="ppca", senter=TRUE,
                                       scale="uv")
biplot(smogbelow.PCA)
summary(smogbelow.PCA)
smogbelow.loadings <- loadings(smogbelow.PCA)
smog.below$PC1 <- unlist(scores(smogbelow.PCA)[, 1])
smog.below$PC2 <- unlist(scores(smogbelow.PCA)[, 2])
```

Based on the result, first two components explained 77%~82% variance of all flammability data, so there are two flammability axes. At flaming stage, the first component is more related to rate of heat release,and the the second component is more related to total heat release. I don't know how to explain components at smoldering stage...


#1b. Do two flammability axes vary acorss species and how? 

```{r flamma_species_variation_flamming}
ggplot(flam.above, aes(sp.cd, PC1, color=sp.cd)) + geom_boxplot() +
  labs(title="First flammability axis at flamming stage(>10cm)\n",
       y="Flmmability axis1", x="Species",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())

ggplot(flam.above, aes(sp.cd, PC2, color=sp.cd)) + geom_boxplot() +
  labs(title="Second flammability axis at flamming stage(>10cm)\n",
       y="Flmmability axis2", x="Species",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())

#ggplot(flambelow.pca, aes(sp.cd, comp1, color=sp.cd)) + geom_boxplot() +
  #labs(title="First flammability axis at flamming stage(<10cm)\n",
       #y="Flmmability axis1", x="Species",
       #color="species name\n") +
  #scale_color_manual(labels=species, values= color) +
  #theme(axis.text.x=element_blank())

#ggplot(flambelow.pca, aes(sp.cd, comp2, color=sp.cd)) + geom_boxplot() +
  #color="species name\n") +
  #scale_color_manual(labels=species, values= color) +
  #theme(axis.text.x=element_blank())
```



```{r flamma_species_variation_smoldering}
#ggplot(smogabove.pca, aes(sp.cd, comp1, color=sp.cd)) + geom_boxplot() +
  #labs(title="First flammability axis at smoldering stage(>10cm)\n",
       #y="Flmmability axis1", x="Species",
       #color="species name\n") +
  #scale_color_manual(labels=species, values= color) +
  #theme(axis.text.x=element_blank())

#ggplot(smogabove.pca, aes(sp.cd, comp2, color=sp.cd)) + geom_boxplot() +
  #labs(title="Second flammability axis at smoldering stage(>10cm)\n",
       #y="Flmmability axis2", x="Species",
       #color="species name\n") +
  #scale_color_manual(labels=species, values= color) +
  #theme(axis.text.x=element_blank())

ggplot(smog.below, aes(sp.cd, PC1, color=sp.cd)) + geom_boxplot() +
  labs(title="First flammability axis at smoldering stage(<10cm)\n",
       y="Flmmability axis1", x="Species",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())

ggplot(smog.below, aes(sp.cd, PC2, color=sp.cd)) + geom_boxplot() +
  labs(title="Second flammability axis at smoldering stage(<10cm)\n",
       y="Flmmability axis2", x="Species",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())
```


#2a. How do total biomass and mass density vary acorss species?
```{r total_biomass_variation_plot}
ggplot(trials, aes(sp.cd, logtmass, color=sp.cd)) + geom_boxplot() +
  labs(title="Logged total biomass variation across species\n",
       y="Logged total biomass", x="Species",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())

ggplot(arcmass, aes(sp.cd, logden, color=sp.cd)) + geom_boxplot() +
  labs(title="Logged biomass density (>10cm) variation across species\n",
       y="Logged biomass density(>10cm)", x="Species",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())
```
```{r homoscedasticity_test}
library(car)
leveneTest(logtmass ~ sp.cd, data=trials)
leveneTest(logden ~ sp.cd, data=arcmass)
```

So, there is heteroscedasticity existing in both total biomass and biomass density data, 
will use Welch's anova

```{r biomass_variation_stat}
oneway.test(logtmass ~ sp.cd, data=trials, na.action = na.omit, 
            var.equal=FALSE)

oneway.test(logden ~ sp.cd, data=arcmass, na.action = na.omit,
            var.equal=FALSE)
```

So, there is sig. variance among groups regarding biomass and biomass density of samples
Next, need to find out where the variance exist, do Games-Howell Post hoc
analysis for heteroscedastic data

```{r games_howell_test}
library(userfriendlyscience)
var.mass <- oneway(trials$logtmass, trials$sp.cd, posthoc="games-howell")
var.mass
var.den <- oneway(arcmass$logden, arcmass$sp.cd, posthoc="games-howell")
var.den
```

#2b. Is density correlated with total aboveground biomass?

```{r density_biomass_correlation}
ggplot(flam.alldata, aes(total.mass, density)) + geom_point()+
  geom_smooth(method="lm", se=FALSE) + facet_wrap(~sp.cd, ncol=2)

ggplot(flam.alldata, aes(total.mass, density10)) + geom_point()+
  geom_smooth(method="lm", se=FALSE) + facet_wrap(~sp.cd, ncol=2)

cor.df <- subset(flam.alldata, select= c("total.mass", "density10", "density"))

cor(cor.df, method="pearson")
```

There is no much strong correlation between biomass density and total biomass, however, 
the total biomass I used here is the actual biomass I measured from burning trial, not
predict biomass. Becasue there will be correlation between biomass density and predict
total biomass, since calculation of biomass density is established on predict biomass

#3a. How do biomass, mass density and biomass ratio influence flammability axes?

```{r biomass_flammability_flaming_stage}

#total biomass -- axis 1

ggplot(flam.above, aes(logtmass, PC1, color=sp.cd)) + geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  labs(title="Total biomass influence on first flammability axis at flamming stage above 10cm\n",
       y="Flmmability axis1", x="Logged total biomass",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())

tmass_axis1LM <- lm(comp1 ~ logtmass, data=massflam.a)
summary(tmass_axis1LM)
plot(tmass_axis1LM)

#total biomass -- axis 2

ggplot(flam.above, aes(logtmass, PC2, color=sp.cd)) + geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  labs(title="Total biomass influence on second flammability axis at flamming stage above 10cm\n",
       y="Flmmability axis2", x="Logged total biomass",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())

tmass_axis2LM <- lm(PC2 ~ logtmass, data=flam.above)
summary(tmass_axis2LM)

#section biomass -- axis1
#ggplot(massflam.a, aes(logmass, comp1, color=sp.cd)) + geom_point() +
  #geom_smooth(method="lm", se=FALSE) +
  #labs(title=" Biomass influence on first flammability axis at flamming 
       #stage(>10cm)\n",
       #y="Flmmability axis1", x="Logged biomass of plant section above 10cm",
       #color="species name\n") +
  #scale_color_manual(labels=species, values= color) +
  #theme(axis.text.x=element_blank())

#mass_axis1LM <- lm(PC1 ~ logmass, data=flam.above)
#summary(mass_axis1LM)


#section biomass -- axis2
#ggplot(flam.above, aes(logmass, PC2, color=sp.cd)) + geom_point() +
  #geom_smooth(method="lm", se=FALSE) +
  #labs(title=" Biomass influence on second flammability axis at flamming stage above 10cm\n",
       #y="Flmmability axis2", x="Logged biomass of plant section above 10cm",
       #color="species name\n") +
  #scale_color_manual(labels=species, values= color) +
  #theme(axis.text.x=element_blank())

#mass_axis2LM <- lm(PC2 ~ logmass, data=flam.above)
#summary(mass_axis2LM)


#biomass density -- axis1

ggplot(flam.above, aes(logden, PC1, color=sp.cd)) + geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  labs(title=" Biomass density influence on first flammability axis at flamming stage above 10cm\n",
       y="Flmmability axis1", x="Logged biomass density of plant section above 10cm",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())

den_axis1LM <- lm(PC1 ~ logden, data=flam.above)
summary(den_axis1LM)

#biomass density -- axis2

ggplot(flam.above, aes(logden, PC2, color=sp.cd)) + geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  labs(title=" Biomass density influence on second flammability axis at flamming stage above 10cm\n",
       y="Flmmability axis2", x="Logged biomass density of plant section above 10cm",
       color="species name\n") +
  scale_color_manual(labels=species, values= color) +
  theme(axis.text.x=element_blank())

den_axis2LM <- lm(PC2 ~ logden, data=flam.above)
summary(den_axis2LM)

#biomass ratio -- axis1
ggplot(flam.above, aes(mratio, PC1, color=sp.cd)) + geom_point() +
  geom_smooth(method="lm", se=FALSE) +
  labs(title="Biomass ratio influence on first flammability axis at flaming stage above 10cm\n", y="f=Flammability axis1", x="Biomass ratio between twos sections",
       color="species name\n") +
  scale_color_manual(labels=species, values=color) +
  theme(axis.text.x=element_blank())

ratio_axis1LM <- lm(PC1 ~ mratio, data=flam.above)
summary(ratio_axis1LM)

#biomass ratio -- axis2
ratio_axis2LM <- lm(PC2 ~ mratio, data=flam.above)
summary(ratio_axis2LM)


```



```{r influence_biomass_adjusted_flammability}
adj_flamaxis1 <- residuals(mass_axis1LM)

adj_denaxis1LM <- lm(adj_flamaxis1 ~ logden, data=flam.above)
summary(adj_denaxis1LM)

adj_ratioaxis1LM <- lm(adj_flamaxis1 ~ mratio, data=flam.above)
summary(adj_ratioaxis1LM)


adj_flamaxis2 <- residuals(mass_axis2LM)

adj_denaxis2LM <- lm(adj_flamaxis2 ~ logden, data=flam.above)
summary(adj_denaxis2LM)

adj_ratioaxis2LM <- lm(adj_flamaxis2 ~ mratio, data=flam.above)
summary(adj_ratioaxis2LM)

```
so,at flaming stage above 10cm section, biomass ratio actually does have significant influence 
on total biomass adjusted flammability axis 1, which is more related to heat release rate.but
no significant influence on flammability axis 2 was found, which is more related to total heat release.

#3b. Is total biomass's effect independent of other traits?

```{r interaction_effects}
tmassp_axis1LM <- lm(PC1 ~ logtmass*sp.cd, data=flam.above)
summary(tmassp_axis1LM)

tmassarc_axis1LM <- lm(comp1 ~ logtmass*logden, data=massflam.a)
summary(massarc_axis1LM)

massarc_axis1LM <- lm(comp1 ~ logmass*logden, data=massflam.a)
summary(massarc_axis1LM)

```

As a conclusion, there are 2 flammability axes in my flammability data. At flaming stage,
the first flammability axis is more related to heat release rate, and the second axis is more related to total heat release. I don't know how to explain flammability axes at smoldering stage. 

Total biomass and section biomass density have significant variations across species. Total biomass has significant influences on first flammability axis at above 10cm plant section but not on second axis, but section biomass(>10cm) has significant influence on both first and second flammability axis(>10cm). I haven't found any significant influence of biomass density.

But when I looked biomass ratio of two sections, it influences the first flammability axis at
flaming stage(not too significant, p-value:0.019) but not on second one. And then I looked how biomass ratio influences total biomass adjusted flammability axes, and I found significant influence of biomass ratio on biomass adjusted first flammablity aixs but not on second one.

So, plant structure seems have significant influence on heat release rate at flaming stage, I haven't looked at how it influence flammability axes at smoldering stage yet.

